<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Login - ZAINE PARFUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#f4f7fb',
                100: '#e9eff7',
                200: '#c8d7ea',
                300: '#a7bfdd',
                400: '#668fc3',
                500: '#2450a9',
                600: '#204898',
                700: '#193778',
                800: '#122758',
                900: '#0d1b40',
              },
              accent: '#e4b58b',
            },
          },
        },
      };
    </script>
    <link rel="stylesheet" href="./animations.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  </head>
  <body class="min-h-screen bg-gradient-to-br from-primary-900 via-primary-800 to-primary-950 flex items-center justify-center p-4">
    <!-- Logo et retour -->
    <a href="index.html" class="absolute top-6 left-6 inline-flex items-center gap-2 text-slate-300 hover:text-white transition">
      <i class="fa-solid fa-arrow-left"></i>
      <span class="text-sm">Retour au site</span>
    </a>

    <!-- Container de login -->
    <div class="w-full max-w-md animate-scale-in">
      <!-- Card -->
      <div class="bg-primary-950/80 backdrop-blur-xl border border-white/10 rounded-3xl shadow-2xl p-8">
        <!-- Header -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-accent/10 border border-accent/20 mb-4">
            <i class="fa-solid fa-lock text-accent text-2xl"></i>
          </div>
          <h1 class="text-2xl font-semibold tracking-wide mb-2">Espace Administrateur</h1>
          <p class="text-sm text-slate-400">Connectez-vous pour accéder au panneau admin</p>
        </div>

        <!-- Formulaire de connexion -->
        <form id="loginForm" class="space-y-5">
          <!-- Email -->
          <div class="space-y-2">
            <label for="email" class="block text-sm text-slate-300">
              <i class="fa-solid fa-envelope text-xs text-slate-500 mr-2"></i>
              Email
            </label>
            <input
              type="email"
              id="email"
              required
              autocomplete="email"
              placeholder="admin@zaine.com"
              class="w-full rounded-xl bg-primary-900 border border-white/10 px-4 py-3 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-accent/70 focus:border-accent/70 transition"
            />
          </div>

          <!-- Mot de passe -->
          <div class="space-y-2">
            <label for="password" class="block text-sm text-slate-300">
              <i class="fa-solid fa-key text-xs text-slate-500 mr-2"></i>
              Mot de passe
            </label>
            <div class="relative">
              <input
                type="password"
                id="password"
                required
                autocomplete="current-password"
                placeholder="••••••••"
                class="w-full rounded-xl bg-primary-900 border border-white/10 px-4 py-3 pr-12 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-accent/70 focus:border-accent/70 transition"
              />
              <button
                type="button"
                id="togglePassword"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-200 transition"
              >
                <i class="fa-solid fa-eye text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Message d'erreur -->
          <div id="errorMessage" class="hidden rounded-xl bg-red-500/10 border border-red-500/20 px-4 py-3 text-sm text-red-300">
            <i class="fa-solid fa-circle-exclamation mr-2"></i>
            <span id="errorText">Une erreur s'est produite</span>
          </div>

          <!-- Bouton de connexion -->
          <button
            type="submit"
            id="loginButton"
            class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-accent text-primary-900 px-6 py-3 text-sm font-medium tracking-wide hover:bg-white transition disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="loginButtonText">Se connecter</span>
            <i id="loginIcon" class="fa-solid fa-arrow-right"></i>
            <div id="loginSpinner" class="hidden spinner"></div>
          </button>
        </form>

        <!-- Footer -->
        <div class="mt-6 pt-6 border-t border-white/10 text-center">
          <p class="text-xs text-slate-500">
            Cet espace est réservé aux administrateurs de ZAINE PARFUM
          </p>
        </div>
      </div>

      <!-- Info de connexion (dev only) -->
      <div class="mt-4 p-4 bg-accent/10 border border-accent/20 rounded-xl text-xs text-slate-300">
        <p class="font-medium mb-1"><i class="fa-solid fa-info-circle mr-1"></i> Mode Développement</p>
        <p>Créez un compte admin via Firebase Console ou utilisez votre compte existant</p>
      </div>
    </div>

    <!-- Script de login -->
    <script type="module">
      import { auth } from './firebase-config.js';
      import { signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

      const loginForm = document.getElementById('loginForm');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const togglePassword = document.getElementById('togglePassword');
      const errorMessage = document.getElementById('errorMessage');
      const errorText = document.getElementById('errorText');
      const loginButton = document.getElementById('loginButton');
      const loginButtonText = document.getElementById('loginButtonText');
      const loginIcon = document.getElementById('loginIcon');
      const loginSpinner = document.getElementById('loginSpinner');

      // Toggle password visibility
      togglePassword.addEventListener('click', () => {
        const type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordInput.type = type;
        const icon = togglePassword.querySelector('i');
        icon.classList.toggle('fa-eye');
        icon.classList.toggle('fa-eye-slash');
      });

      // Handle login
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = emailInput.value.trim();
        const password = passwordInput.value;

        // Hide error message
        errorMessage.classList.add('hidden');

        // Show loading state
        loginButton.disabled = true;
        loginButtonText.textContent = 'Connexion...';
        loginIcon.classList.add('hidden');
        loginSpinner.classList.remove('hidden');

        try {
          // Sign in with Firebase
          await signInWithEmailAndPassword(auth, email, password);
          
          // Success! Redirect to admin page
          window.location.href = 'admin.html';
        } catch (error) {
          // Show error message
          console.error('Login error:', error);
          
          let message = 'Une erreur s\'est produite. Veuillez réessayer.';
          
          if (error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password') {
            message = 'Email ou mot de passe incorrect';
          } else if (error.code === 'auth/user-not-found') {
            message = 'Aucun compte trouvé avec cet email';
          } else if (error.code === 'auth/invalid-email') {
            message = 'Adresse email invalide';
          } else if (error.code === 'auth/too-many-requests') {
            message = 'Trop de tentatives. Veuillez réessayer plus tard.';
          }

          errorText.textContent = message;
          errorMessage.classList.remove('hidden');
          errorMessage.classList.add('animate-shake');
          
          setTimeout(() => {
            errorMessage.classList.remove('animate-shake');
          }, 400);

          // Reset button state
          loginButton.disabled = false;
          loginButtonText.textContent = 'Se connecter';
          loginIcon.classList.remove('hidden');
          loginSpinner.classList.add('hidden');
        }
      });

      // Check if already logged in
      auth.onAuthStateChanged((user) => {
        if (user) {
          // Already logged in, redirect to admin
          window.location.href = 'admin.html';
        }
      });
    </script>
  </body>
</html>
